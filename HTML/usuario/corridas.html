<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corridas Guardadas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #FFF;
    }
    /* Header */
 /* Encabezado */
/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background-color: #FCF0E3;
}

.header img {
  max-width: 100px;
  margin-right: auto;
  padding: 0px 100px;
}

.nav-links {
  display: flex;
  align-items: center;
  gap: 20px;
}

.nav-links a {
  color: #333;
  text-decoration: none;
  font-weight: bold;
}

.nav-links a:hover {
  text-decoration: underline;
}

/* Dropdown Menu para Boletos */
.dropdown {
  position: relative;
}

.dropbtn {
  color: #333;
  font-size: 16px;
  font-weight: bold;
  text-decoration: none;
  cursor: pointer;
  padding: 10px;
}

.dropdown-content {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 5px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  z-index: 1000;
}

.dropdown-content a {
  display: block;
  padding: 10px 15px;
  color: #333;
  text-decoration: none;
  font-size: 14px;
  transition: background-color 0.3s ease;
}

.dropdown-content a:hover {
  background-color: #f0f0f0;
}

.dropdown:hover .dropdown-content {
  display: block;
}

/* Botón de cerrar sesión */
.logout-button {
  background-color: #f28b82;
  color: #fff;
  padding: 10px 20px;
  border-radius: 5px;
  text-decoration: none;
  display: inline-block;
  cursor: pointer;
  font-size: 16px;
  text-align: center;
}

.logout-button:hover {
  background-color: #e57373;
}


/* Main Content */
.main-container {
  flex: 1;
  padding: 20px;
  margin: 10px;
}

.main-container h1 {
  font-size: 1.5rem;
  margin-bottom: 20px;
}

.corrida {
  border-bottom: 1px solid #ddd;
  padding: 20px 0;
}

.corrida h2 {
  font-size: 1.2rem;
  margin: 0;
}

.corrida p {
  margin: 10px 0;
}

.corrida .btn {
  padding: 10px 20px;
  background-color: #d21f26;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .card h3 {
      margin: 0 0 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="../ADO-Autobuses-de-Oriente-Logo-700x394.png" alt="ADO Logo">
    <div class="nav-links">
      <a href="../usuario/inicio.html">Inicio</a>
  
      <!-- Menú desplegable para Boletos -->
      <div class="dropdown">
        <a href="#" class="dropbtn">Boletos</a>
        <div class="dropdown-content">
          <a href="../sesion/compra de boleto.html">Comprar boleto</a>
        </div>
      </div>
  
      <!-- Enlace simple para Perfil -->
      <a href="../usuario/lista-corridas.html">Corridas</a>  <a href="../usuario/perfil.html">Perfil</a>
  
    
      <a href="./index.html" id="logoutButton" name="logoutButton" class="logout-button">Cerrar Sesión</a>
  </div>  </div>

  <div class="container" id="corridasContainer">
    <h2>Corridas Guardadas</h2>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const container = document.getElementById("corridasContainer");

    function fetchCorridas() {
      fetch("http://127.0.0.1:8000/api/corrida/view", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ token: token }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.corridas && data.corridas.length > 0) {
          data.corridas.forEach((corrida, index) => {
            const totalAsientos = corrida.asientos.length;
            const disponibles = corrida.asientos.filter(asiento => asiento.estado === "disponible").length;
            const ocupados = totalAsientos - disponibles;
            function formatHour(hour) {
              // Verifica que la hora esté en un formato válido
              if (hour && hour.includes(":")) {
                // Divide la hora en sus componentes
                const [hours, minutes] = hour.split(":").map(part => parseInt(part, 10));
                if (!isNaN(hours) && !isNaN(minutes)) {
                  // Determina si es AM o PM
                  const period = hours >= 12 ? "PM" : "AM";
                  // Convierte las horas al formato de 12 horas
                  const adjustedHours = hours % 12 || 12; // Convierte "0" o "12" a "12" en formato 12 horas
                  return `${adjustedHours}:${minutes.toString().padStart(2, "0")} ${period}`;
                }
              }
              return hour; // Devuelve el valor original si no cumple el formato esperado
            }
            container.innerHTML += `
              <div class="corrida">
                <h2>Detalles de la Corrida</h2>
                <div class="container">
                  <div class="card">
                    <h3>Corrida ${index + 1}</h3>
                    <p><strong>Autobús:</strong> ${corrida.id}</p>
                    <p><strong>Autobús:</strong> ${corrida.id_autobus}</p>
                    <p><strong>Origen:</strong> ${corrida.origen}</p>
                    <p><strong>Destino:</strong> ${corrida.destino}</p>
                    <p><strong>Fecha:</strong> ${corrida.fecha}</p>
                    <p><strong>Hora de salida:</strong>  ${formatHour(corrida.hora_salida)}</p>
                    <p><strong>Hora estimada de llegada:</strong> ${formatHour( corrida.hora_estima_llegada)}</p>
                    <p><strong>Tipo de Corrida:</strong> ${corrida.tipo_corrida}</p>
                    <p><strong>Total Asientos:</strong> ${totalAsientos}</p>
                    <p><strong>Asientos Disponibles:</strong> ${disponibles}</p>
                    <p><strong>Asientos Ocupados:</strong> ${ocupados}</p>
                    <p><strong>Precio:</strong> $${corrida.precio}</p>
                    <button class="btn" onclick="idCorri(${corrida.id})">
                      Comprar boleto
                    </button>
                  </div>
                </div>
              </div>
            `;
          });
        } else {
          container.innerHTML += "<p>No hay corridas disponibles.</p>";
        }
      })
      .catch(error => {
        console.error("Error al obtener las corridas:", error);
        container.innerHTML += "<p>Ocurrió un error al cargar las corridas. Intenta nuevamente más tarde.</p>";
      });
    }

    function idCorri(id) {
      // Guardar los datos de la corrida en localStorage
      localStorage.setItem('idCorrida', id);

      // Redirigir al formulario de compra con los datos
      window.location.href = "../sesion/compra de boleto.html"; 
    }

    // Llamar a la función al cargar la página
    fetchCorridas();
  </script>
</body>
<script src="../apis/sesion.js"></script>
<script src="../apis/logout.js"></script>
</html>
